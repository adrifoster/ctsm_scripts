#!/usr/bin/env bash

#
# #########################
# Purpose: Create and build a single-point case for CTSM runs
# Author: Adrianna C. Foster
# Date: September, 2021
# bash version 4.2.46
# #########################
# #########################
# Input format: text file
# #########################
# #########################
# Notes: Makes use of the config_parse script. If you want to add more
#        parameters, see the notes for that script.
#        This also assumes you have already subset the correct surface, domain,
#        and datm files. See subset_data.py script.

## Parameters ------------------------------------------------------------------
# CONF              - config file name             (argument for script)
# MACH              - machine (izumi/cheyenne)     (in config file)
# PROJECT           - project code                 (in config file)
# SRCDIR            - CTSM source code directory   (in config file)
# TAG               - name of case                 (in config file)
# SITE              - site name                    (in config file)
# FATES             - use fates or not             (in config file)
# PARAM_FILE        - FATES parameter file         (in config file)
# PARAM_DIR         - FATES param file location    (in config file)
# CASE_DIR          - case directory path          (in config file)
# COMP              - compset for run              (in config file)
# RES               - resolution of run            (in config file)
# STOPN             - how long to run              (in config file)
# RESUBN            - times to resubmit run        (in config file)
# STOPVAL           - units for STOPN              (in config file)
# RESTVAL           - units for RESUBN             (in config file)
# STATDATE          - start date for run           (in config file)
# DATMSTARTYR       - start year to loop datm over (in config file)
# DATMSTOPYR        - end year to loop datm over   (in config file)
# DATMMODE          - mode for data atm. component (in config file)
# CLM_USRDAT_DOMAIN - subset domain file           (in config file)
# CLM_DOMAIN_DIR    - subset domain location       (in config file)
# CLM_SURFDAT_DIR   - subset surface data location (in config file)
# CLM_USRDAT_SURDAT - subset surface data file     (in config file)
# USER_DATM_DIR     - location of datm.streams*    (in config file)
# WALL_TIME         - wallclock time               (in config file)


## Config file name
if [ $# -eq 0 ]
  then
    echo "Enter config file name"
    read CONF
  else
    CONF=$1
fi

## Parse the config file to get parameters
source config_parse ${CONF}

## Get CTSM git version - this will go into case name
cd ${SRCDIR}
githashctsm=`git log -n 1 --format=%h`

## Get the FATES git version if running fates - this will also go into case name
if [[ "$FATES" == "1" ]]
then
  cd src/fates
  githashfates=`git log -n 1 --format=%h`

  ## Create case name with ctsm and fates githash
  case_name=${CASE_DIR}/${TAG}_${githashctsm}_${githashfates}
else
  ## Create case name with just ctsm githash
  case_name=${CASE_DIR}/${TAG}_${githashctsm}
fi

## Define CIME directory
base_dir=${SRCDIR}/cime/scripts

## Create the case
cd ${base_dir}
./create_newcase --case ${case_name} --res ${RES} --compset ${COMP} --project ${PROJECT} --run-unsupported --mach ${MACH}

cd ${case_name}

## Modify env_mach_pes file
## Increase to 8 nodes
./xmlchange NTASKS_ATM=1
./xmlchange NTASKS_LND=1
./xmlchange NTASKS_ROF=1
./xmlchange NTASKS_ICE=1
./xmlchange NTASKS_OCN=1
./xmlchange NTASKS_CPL=1
./xmlchange NTASKS_GLC=1
./xmlchange NTASKS_WAV=1
./xmlchange NTASKS_ESP=1

./xmlchange NTHRDS_ATM=1
./xmlchange NTHRDS_LND=1
./xmlchange NTHRDS_ROF=1
./xmlchange NTHRDS_ICE=1
./xmlchange NTHRDS_OCN=1
./xmlchange NTHRDS_CPL=1
./xmlchange NTHRDS_GLC=1
./xmlchange NTHRDS_WAV=1
./xmlchange NTHRDS_ESP=1

./xmlchange ROOTPE_ATM=0
./xmlchange ROOTPE_LND=0
./xmlchange ROOTPE_ROF=0
./xmlchange ROOTPE_ICE=0
./xmlchange ROOTPE_OCN=0
./xmlchange ROOTPE_CPL=0
./xmlchange ROOTPE_GLC=0
./xmlchange ROOTPE_WAV=0
./xmlchange ROOTPE_ESP=0

## Must do this for single-point runs
./xmlchange MPILIB=mpi-serial

## Run case-setup
./case.setup

## Modify env_run parameters - can add more parameters using the config_parse
## script
## Note for variables that require quotes you must use the double then single
## quotes approach for it to work.
./xmlchange --id STOP_N --val ${STOPN}
./xmlchange --id RUN_STARTDATE --val $STARTDATE
./xmlchange --id STOP_OPTION --val ${STOPVAL}
./xmlchange --id REST_OPTION --val ${RESTVAL}
./xmlchange --id RESUBMIT --val ${RESUBN}
./xmlchange --id CLM_FORCE_COLDSTART --val on
./xmlchange --id JOB_WALLCLOCK_TIME --val ${WALL_TIME}
./xmlchange --id DATM_CLMNCEP_YR_ALIGN --val ${DATMSTARTYR}
./xmlchange --id DATM_CLMNCEP_YR_START --val ${DATMSTARTYR}
./xmlchange --id DATM_CLMNCEP_YR_END --val ${DATMSTOPYR}
./xmlchange --id DATM_MODE --val ${DATMMODE}
./xmlchange --id ATM_DOMAIN_FILE --val ${CLM_USRDAT_DOMAIN}
./xmlchange --id ATM_DOMAIN_PATH --val ${CLM_DOMAIN_DIR}
./xmlchange --id LND_DOMAIN_FILE --val ${CLM_USRDAT_DOMAIN}
./xmlchange --id LND_DOMAIN_PATH --val ${CLM_DOMAIN_DIR}
./xmlchange --id CLM_USRDAT_NAME --val ${SITE}
./xmlchange --id MOSART_MODE --val NULL

## Need jobqueue for running on izumi
if [[ "$MACH" == "izumi" ]]
then
  ./xmlchange --id JOB_QUEUE --val verylong
fi


## Update the user_nl_datm file
cat > user_nl_datm <<EOF
mapalgo = 'nn','nn','nn','nn','nn'
EOF

## Update the user_nl_clm file
## the fsurdat is used for updating the surface dataset file for
## singlepoint runs

if [[ "$FATES" == "1" ]]
then

cat > user_nl_clm <<EOF
fsurdat = '${CLM_SURFDAT_DIR}/${CLM_USRDAT_SURDAT}'
hist_fincl1 = 
'FATES_NPATCHES', 'FATES_NCOHORTS', 'FATES_TRIMMING', 'FATES_AREA_PLANTS', \
'FATES_AREA_TREES', 'FATES_COLD_STATUS', 'FATES_DROUGHT_STATUS', 'FATES_GDD', \
'FATES_NCHILLDAYS', 'FATES_NCOLDDAYS', 'FATES_DAYSINCE_COLDLEAFOFF', 'FATES_DAYSINCE_COLDLEAFON', \
'FATES_DAYSINCE_DROUGHTLEAFOFF', 'FATES_DAYSINCE_DROUGHTLEAFON', 'FATES_MEANLIQVOL_DROUGHTPHEN', 'FATES_CANOPY_SPREAD', \
'FATES_VEGC_PF', 'FATES_LEAFC_PF', 'FATES_STOREC_PF', 'FATES_CROWNAREA_PF', \
'FATES_CANOPYCROWNAREA_PF', 'FATES_GPP_PF', 'FATES_NPP_PF', 'FATES_NPLANT_PF', \
'FATES_RECRUITMENT_PF', 'FATES_MORTALITY_PF', 'FATES_PATCHAREA_AP', 'FATES_LAI_AP', \
'FATES_CANOPYAREA_AP', 'FATES_NCL_AP', 'FATES_NPATCH_AP', 'FATES_CANOPYAREA_HT', \
'FATES_LEAFAREA_HT', 'FATES_VEGC_AP', 'FATES_SECONDARY_FOREST_FRACTION', 'FATES_WOOD_PRODUCT', \
'FATES_SECONDARY_FOREST_VEGC', 'FATES_SECONDAREA_ANTHRODIST_AP', 'FATES_SECONDAREA_DIST_AP', 'FATES_NESTEROV_INDEX', \
'FATES_IGNITIONS', 'FATES_FDI', 'FATES_ROS', 'FATES_EFFECT_WSPEED', \
'FATES_FUELCONSUMED', 'FATES_FIRE_INTENSITY', 'FATES_FIRE_INTENSITY_BURNFRAC', 'FATES_BURNFRAC', \
'FATES_FUEL_MEF', 'FATES_FUEL_BULKD', 'FATES_FUEL_EFF_MOIST', 'FATES_FUEL_SAV', \
'FATES_FUEL_AMOUNT', 'FATES_FRAGMENTATION_SCALER_SL', 'FATES_FUEL_MOISTURE_FC', 'FATES_FUEL_AMOUNT_FC', \
'FATES_FUEL_AMOUNT_APFC', 'FATES_BURNFRAC_AP', 'FATES_FIRE_INTENSITY_BURNFRAC_AP', 'FATES_FUEL_AMOUNT_AP', \
'FATES_FUEL_BURNT_BURNFRAC_FC', 'FATES_LITTER_IN', 'FATES_LITTER_OUT', 'FATES_SEED_BANK', \
'FATES_SEEDS_IN', 'FATES_LITTER_IN_EL', 'FATES_LITTER_OUT_EL', 'FATES_SEED_BANK_EL', \
'FATES_SEEDS_IN_LOCAL_EL', 'FATES_SEEDS_IN_EXTERN_EL', 'FATES_SEED_GERM_EL', 'FATES_SEED_DECAY_EL', \
'FATES_STOREC', 'FATES_VEGC', 'FATES_SAPWOODC', 'FATES_LEAFC', \
'FATES_FROOTC', 'FATES_REPROC', 'FATES_CEFFLUX', 'FATES_STOREN', \
'FATES_STOREN_TF', 'FATES_VEGN', 'FATES_SAPWOODN', 'FATES_LEAFN', \
'FATES_FROOTN', 'FATES_REPRON', 'FATES_NH4UPTAKE', 'FATES_NO3UPTAKE', \
'FATES_NEFFLUX', 'FATES_NNEED', 'FATES_STOREP', 'FATES_STOREP_TF', \
'FATES_VEGP', 'FATES_SAPWOODP', 'FATES_LEAFP', 'FATES_FROOTP', \
'FATES_REPROP', 'FATES_PUPTAKE', 'FATES_PEFFLUX', 'FATES_PNEED', \
'FATES_STRUCTC', 'FATES_NONSTRUCTC', 'FATES_VEGC_ABOVEGROUND', 'FATES_CANOPY_VEGC', \
'FATES_USTORY_VEGC', 'FATES_PRIMARY_PATCHFUSION_ERR', 'FATES_DISTURBANCE_RATE_P2P', 'FATES_DISTURBANCE_RATE_P2S', \
'FATES_DISTURBANCE_RATE_S2S', 'FATES_DISTURBANCE_RATE_FIRE', 'FATES_DISTURBANCE_RATE_LOGGING', 'FATES_DISTURBANCE_RATE_TREEFALL', \
'FATES_DISTURBANCE_RATE_POTENTIAL', 'FATES_HARVEST_CARBON_FLUX', 'FATES_STOMATAL_COND', 'FATES_LBLAYER_COND', \
'FATES_NPP', 'FATES_GPP', 'FATES_AUTORESP', 'FATES_GROWTH_RESP', \
'FATES_MAINT_RESP', 'FATES_STOMATAL_COND_AP', 'FATES_LBLAYER_COND_AP', 'FATES_NPP_AP', \
'FATES_GPP_AP', 'FATES_GPP_CANOPY', 'FATES_AUTORESP_CANOPY', 'FATES_GPP_UNDERSTORY', \
'FATES_AUTORESP_UNDERSTORY', 'FATES_PARSUN_Z_CLLL', 'FATES_PARSHA_Z_CLLL', 'FATES_PARSUN_Z_CLLLPF', \
'FATES_PARSHA_Z_CLLLPF', 'FATES_PARSUN_Z_CL', 'FATES_PARSHA_Z_CL', 'FATES_LAISUN_Z_CLLL', \
'FATES_LAISHA_Z_CLLL', 'FATES_LAISUN_Z_CLLLPF', 'FATES_LAISHA_Z_CLLLPF', 'FATES_LAISUN_TOP_CL', \
'FATES_LAISHA_TOP_CL', 'FATES_FABD_SUN_CLLLPF', 'FATES_FABD_SHA_CLLLPF', 'FATES_FABI_SUN_CLLLPF', \
'FATES_FABI_SHA_CLLLPF', 'FATES_FABD_SUN_CLLL', 'FATES_FABD_SHA_CLLL', 'FATES_FABI_SUN_CLLL', \
'FATES_FABI_SHA_CLLL', 'FATES_PARPROF_DIR_CLLLPF', 'FATES_PARPROF_DIF_CLLLPF', 'FATES_PARPROF_DIR_CLLL', \
'FATES_PARPROF_DIF_CLLL', 'FATES_FABD_SUN_TOPLF_CL', 'FATES_FABD_SHA_TOPLF_CL', 'FATES_FABI_SUN_TOPLF_CL', \
'FATES_FABI_SHA_TOPLF_CL', 'FATES_NET_C_UPTAKE_CLLL', 'FATES_CROWNAREA_CLLL', 'FATES_CROWNAREA_CL', \
'FATES_DEMOTION_CARBONFLUX', 'FATES_PROMOTION_CARBONFLUX', 'FATES_MORTALITY_CFLUX_CANOPY', 'FATES_MORTALITY_CFLUX_UNDERSTORY', \
'FATES_NPLANT_APSZ', 'FATES_NPLANT_CANOPY_APSZ', 'FATES_NPLANT_USTORY_APSZ', 'FATES_DDBH_CANOPY_APSZ', \
'FATES_DDBH_USTORY_APSZ', 'FATES_MORTALITY_CANOPY_APSZ', 'FATES_MORTALITY_USTORY_APSZ', 'FATES_NPLANT_APSZPF', \
'FATES_NPP_APPF', 'FATES_VEGC_APPF', 'FATES_SCORCH_HEIGHT_APPF', 'FATES_GPP_SZPF', \
'FATES_GPP_CANOPY_SZPF', 'FATES_AUTORESP_CANOPY_SZPF', 'FATES_GPP_USTORY_SZPF', 'FATES_AUTORESP_USTORY_SZPF', \
'FATES_NPP_SZPF', 'FATES_LEAF_ALLOC_SZPF', 'FATES_SEED_ALLOC_SZPF', 'FATES_FROOT_ALLOC_SZPF', \
'FATES_BGSAPWOOD_ALLOC_SZPF', 'FATES_BGSTRUCT_ALLOC_SZPF', 'FATES_AGSAPWOOD_ALLOC_SZPF', 'FATES_AGSTRUCT_ALLOC_SZPF', \
'FATES_STORE_ALLOC_SZPF', 'FATES_DDBH_SZPF', 'FATES_GROWTHFLUX_SZPF', 'FATES_GROWTHFLUX_FUSION_SZPF', \
'FATES_DDBH_CANOPY_SZPF', 'FATES_DDBH_USTORY_SZPF', 'FATES_BASALAREA_SZPF', 'FATES_VEGC_ABOVEGROUND_SZPF', \
'FATES_NPLANT_SZPF', 'FATES_NPLANT_ACPF', 'FATES_MORTALITY_BACKGROUND_SZPF', 'FATES_MORTALITY_HYDRAULIC_SZPF', \
'FATES_MORTALITY_CSTARV_SZPF', 'FATES_MORTALITY_IMPACT_SZPF', 'FATES_MORTALITY_FIRE_SZPF', 'FATES_MORTALITY_CROWNSCORCH_SZPF', \
'FATES_MORTALITY_CAMBIALBURN_SZPF', 'FATES_MORTALITY_TERMINATION_SZPF', 'FATES_MORTALITY_LOGGING_SZPF', 'FATES_MORTALITY_FREEZING_SZPF', \
'FATES_MORTALITY_SENESCENCE_SZPF', 'FATES_MORTALITY_AGESCEN_SZPF', 'FATES_MORTALITY_AGESCEN_ACPF', 'FATES_MORTALITY_CANOPY_SZPF', \
'FATES_C13DISC_SZPF', 'FATES_STOREC_CANOPY_SZPF', 'FATES_LEAFC_CANOPY_SZPF', 'FATES_NPLANT_CANOPY_SZPF', \
'FATES_MORTALITY_USTORY_SZPF', 'FATES_STOREC_USTORY_SZPF', 'FATES_LEAFC_USTORY_SZPF', 'FATES_NPLANT_USTORY_SZPF', \
'FATES_CWD_ABOVEGROUND_DC', 'FATES_CWD_BELOWGROUND_DC', 'FATES_CWD_ABOVEGROUND_IN_DC', 'FATES_CWD_BELOWGROUND_IN_DC', \
'FATES_CWD_ABOVEGROUND_OUT_DC', 'FATES_CWD_BELOWGROUND_OUT_DC', 'FATES_AUTORESP_SZPF', 'FATES_GROWAR_SZPF', \
'FATES_MAINTAR_SZPF', 'FATES_RDARK_SZPF', 'FATES_AGSAPMAINTAR_SZPF', 'FATES_BGSAPMAINTAR_SZPF', \
'FATES_FROOTMAINTAR_SZPF', 'FATES_DDBH_CANOPY_SZ', 'FATES_DDBH_USTORY_SZ', 'FATES_YESTCANLEV_CANOPY_SZ', \
'FATES_YESTCANLEV_USTORY_SZ', 'FATES_BASALAREA_SZ', 'FATES_VEGC_ABOVEGROUND_SZ', 'FATES_VEGC_SZ', \
'FATES_DEMOTION_RATE_SZ', 'FATES_PROMOTION_RATE_SZ', 'FATES_NPLANT_CANOPY_SZ', 'FATES_LAI_CANOPY_SZ', \
'FATES_SAI_CANOPY_SZ', 'FATES_MORTALITY_CANOPY_SZ', 'FATES_NPLANT_USTORY_SZ', 'FATES_LAI_USTORY_SZ', \
'FATES_SAI_USTORY_SZ', 'FATES_NPLANT_SZ', 'FATES_NPLANT_AC', 'FATES_MORTALITY_BACKGROUND_SZ', \
'FATES_MORTALITY_HYDRAULIC_SZ', 'FATES_MORTALITY_CSTARV_SZ', 'FATES_MORTALITY_IMPACT_SZ', 'FATES_MORTALITY_FIRE_SZ', \
'FATES_MORTALITY_TERMINATION_SZ', 'FATES_MORTALITY_LOGGING_SZ', 'FATES_MORTALITY_FREEZING_SZ', 'FATES_MORTALITY_SENESCENCE_SZ', \
'FATES_MORTALITY_AGESCEN_SZ', 'FATES_MORTALITY_AGESCEN_AC', 'FATES_NPP_CANOPY_SZ', 'FATES_NPP_USTORY_SZ', \
'FATES_MORTALITY_USTORY_SZ', 'FATES_TRIMMING_CANOPY_SZ', 'FATES_TRIMMING_USTORY_SZ', 'FATES_CROWNAREA_CANOPY_SZ', \
'FATES_CROWNAREA_USTORY_SZ', 'FATES_LEAFCTURN_CANOPY_SZ', 'FATES_FROOTCTURN_CANOPY_SZ', 'FATES_STORECTURN_CANOPY_SZ', \
'FATES_STRUCTCTURN_CANOPY_SZ', 'FATES_SAPWOODCTURN_CANOPY_SZ', 'FATES_SEED_PROD_CANOPY_SZ', 'FATES_LEAF_ALLOC_CANOPY_SZ', \
'FATES_FROOT_ALLOC_CANOPY_SZ', 'FATES_SAPWOOD_ALLOC_CANOPY_SZ', 'FATES_STRUCT_ALLOC_CANOPY_SZ', 'FATES_SEED_ALLOC_CANOPY_SZ', \
'FATES_STORE_ALLOC_CANOPY_SZ', 'FATES_LEAFMAINTAR', 'FATES_FROOTMAINTAR', 'FATES_CROOTMAINTAR', \
'FATES_LSTEMMAINTAR', 'FATES_RDARK_CANOPY_SZ', 'FATES_LSTEMMAINTAR_CANOPY_SZ', 'FATES_CROOTMAINTAR_CANOPY_SZ', \
'FATES_FROOTMAINTAR_CANOPY_SZ', 'FATES_GROWAR_CANOPY_SZ', 'FATES_MAINTAR_CANOPY_SZ', 'FATES_LEAFCTURN_USTORY_SZ', \
'FATES_FROOTCTURN_USTORY_SZ', 'FATES_STORECTURN_USTORY_SZ', 'FATES_STRUCTCTURN_USTORY_SZ', 'FATES_SAPWOODCTURN_USTORY_SZ', \
'FATES_SEED_PROD_USTORY_SZ', 'FATES_LEAF_ALLOC_USTORY_SZ', 'FATES_FROOT_ALLOC_USTORY_SZ', 'FATES_SAPWOOD_ALLOC_USTORY_SZ', \
'FATES_STRUCT_ALLOC_USTORY_SZ', 'FATES_SEED_ALLOC_USTORY_SZ', 'FATES_STORE_ALLOC_USTORY_SZ', 'FATES_RDARK_USTORY_SZ', \
'FATES_LSTEMMAINTAR_USTORY_SZ', 'FATES_CROOTMAINTAR_USTORY_SZ', 'FATES_FROOTMAINTAR_USTORY_SZ', 'FATES_GROWAR_USTORY_SZ', \
'FATES_MAINTAR_USTORY_SZ', 'FATES_NEP', 'FATES_HET_RESP', 'FATES_FIRE_CLOSS', \
'FATES_FIRE_FLUX_EL', 'FATES_CBALANCE_ERROR', 'FATES_ERROR_EL', 'FATES_LITTER_AG_FINE_EL', \
'FATES_LITTER_BG_FINE_EL', 'FATES_LITTER_BG_CWD_EL', 'FATES_LITTER_AG_CWD_EL', 'FATES_LITTER_CWD_ELDC', \
'FATES_VEGC_SZPF', 'FATES_LEAFC_SZPF', 'FATES_FROOTC_SZPF', 'FATES_SAPWOODC_SZPF', \
'FATES_STOREC_SZPF', 'FATES_REPROC_SZPF', 'FATES_CEFFLUX_SZPF', 'FATES_VEGN_SZPF', \
'FATES_LEAFN_SZPF', 'FATES_FROOTN_SZPF', 'FATES_SAPWOODN_SZPF', 'FATES_STOREN_SZPF', \
'FATES_STOREN_TF_CANOPY_SZPF', 'FATES_STOREN_TF_USTORY_SZPF', 'FATES_REPRON_SZPF', 'FATES_NH4UPTAKE_SZPF', \
'FATES_NO3UPTAKE_SZPF', 'FATES_NEFFLUX_SZPF', 'FATES_NNEED_SZPF', 'FATES_VEGP_SZPF', \
'FATES_LEAFP_SZPF', 'FATES_FROOTP_SZPF', 'FATES_SAPWOODP_SZPF', 'FATES_STOREP_SZPF', \
'FATES_STOREP_TF_CANOPY_SZPF', 'FATES_STOREP_TF_USTORY_SZPF', 'FATES_REPROP_SZPF', 'FATES_PUPTAKE_SZPF', \
'FATES_PEFFLUX_SZPF', 'FATES_PNEED_SZPF', 'FATES_LEAF_ALLOC', 'FATES_SEED_ALLOC', \
'FATES_STEM_ALLOC', 'FATES_FROOT_ALLOC', 'FATES_CROOT_ALLOC', 'FATES_STORE_ALLOC', \
'FATES_ERRH2O_SZPF', 'FATES_TRAN_SZPF', 'FATES_SAPFLOW_SZPF', 'FATES_SAPFLOW', \
'FATES_ITERH1_SZPF', 'FATES_ITERH2_SZPF', 'FATES_ROOTH2O_ABS_SZPF', 'FATES_ROOTH2O_TRANS_SZPF', \
'FATES_STEMH2O_SZPF', 'FATES_LEAFH2O_SZPF', 'FATES_ROOTH2O_POT_SZPF', 'FATES_ROOTH2O_TRANSPOT_SZPF', \
'FATES_STEMH2O_POT_SZPF', 'FATES_LEAFH2O_POT_SZPF', 'FATES_ROOT_ABSFRAC_SZPF', 'FATES_ROOT_TRANSFRAC_SZPF', \
'FATES_STEMH2O_FRAC_SZPF', 'FATES_LEAFH2O_FRAC_SZPF', 'FATES_BTRAN_SZPF', 'FATES_ROOTWGT_SOILVWC', \
'FATES_ROOTWGT_SOILVWCSAT', 'FATES_ROOTWGT_SOILMATPOT', 'FATES_SOILMATPOT_SL', 'FATES_SOILVWC_SL', \
'FATES_SOILVWCSAT_SL', 'FATES_ROOTUPTAKE', 'FATES_ROOTUPTAKE_SL', 'FATES_ROOTUPTAKE0_SZPF', \
'FATES_ROOTUPTAKE10_SZPF', 'FATES_ROOTUPTAKE50_SZPF', 'FATES_ROOTUPTAKE100_SZPF', 'FATES_VEGH2O', \
'FATES_VEGH2O_DEAD', 'FATES_VEGH2O_RECRUIT', 'FATES_VEGH2O_GROWTURN_ERR', 'FATES_VEGH2O_HYDRO_ERR'

use_fates=.true.
fates_parteh_mode=2
fates_spitfire_mode=0
EOF

else
cat > user_nl_clm <<EOF
fsurdat = '${CLM_SURFDAT_DIR}/${CLM_USRDAT_SURDAT}'
EOF

fi

## Copy the user_datm.streams* files
cp ${USER_DATM_DIR}/user_datm* .


## Build the case
./case.build
